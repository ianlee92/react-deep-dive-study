# 6장 리액트 개발 도구로 디버깅하기

## 6.1 리액트 개발도구란?

react-dev-tools,, 브라우저 확장 프로그램을 사용하는 것 추천

---

## 6.2 리액트 개발 도구 설치

확장 프로그램 이용

---

## 6.3 리액트 개발 도구 활용하기

개발자 도구에 Components와 Profiler 추가됨

### 6.3.1 컴포넌트

- 리액트 앱의 컴포넌트 트리 확인
- 컴포넌트의 구조뿐만 아니라 props와 내부 hooks 등 다양한 정보 확인
- 컴포넌트 트리
    - 트리 구조
    - 함수 선언식과 표현식으로 작성된 컴포넌트는 트리에 컴포넌트명이 표시됨
    - memo로 익명 함수 컴포넌트를 감싸거나 고차 컴포넌트로 감싼 컴포넌트는 컴포넌트 명이 표시되지 않음
    - 그런경우 Component.displayName = ‘어떤 컴포넌트’ 로 작성하는 방법이 있음
- 컴포넌트명과 props, rendered by
    - 눈 모양 아이콘 → elements 탭으로 이동
    - 벌레모양 아이콘 → console 탭에 해당 컴포넌트가 찍힘
    - {} 아이콘 → source 탭으로 이동

### 6.3.2 프로파일러

- 리액트의 렌더링 과정에서 어떤 컴포넌트가 렌더링됐는지, 또 몇 차례나 렌더링이 일어났으며 어떤 작업에서 오래 걸렸는지 등 추적 (프로덕션 빌드에서 사용 X)
- 프로파일링 메뉴
    - Start Profiling 버튼 : 누르면 프로파일링이 시작
    - Reload and Start profiling 버튼 : 누르면 웹페이지가 새로고침되면서 동시에 프로파일링이 시작
    - Stop profiling 버튼 : 프로파일링된 현재 내용을 모두 지우는 버튼
    - Load Profile, Save Profile 버튼 : 프로파일링 결과를 JSON으로 내보내고 불러올 수 있지만 직접 열어서 확인하기에는 매우 복잡
- **Flamegraph**
    - 렌더커밋별 작업 나타냄 (노란색일수로 오래 걸리고, 초록색 가까울수록 빠름)
    - 렌더링되지 않는 컴포넌트는 회색으로 표시
        - 메모이제이션 작동여부, 의도에 따른 렌더링 작동 여부 판별 가능
- **Ranked**
    - 해당 커밋에서 렌더링하는데 오랜 시간이 걸린 컴포넌트를 순서대로 나열한 그래프
    - Flamegraph롸 다르게 렌더링 발생한 컴포넌트만 보여줌
- **타임라인 (리액트 18이상)**
    - 시간이 지남에 따라 컴포넌트에서 일어나는일 확인 가능
    - 프로파일링 기간 동안 무슨일이 있었는지, 무엇이 렌더링, 어느시점에 렌더링, 리액트의 유휴 시간은 확인 가능
- 사용 예시
    - 불필요한 setState 감지
    - state 갱신에 따른 불필요한 리렌더링 요소 포함 점검 (최소 컴포넌트 단위 분리하는것이 좋음)
    - 컴포넌트 memoziation

---

# 7장 크롬 개발자 도구를 활용한 애플리케이션 분석

## 7.1 크롬 개발자 도구란?

웹페이지에서 일어나는 거의 모든 일을 확인할 수 있는 강력한 개발 도구

---

## 7.2 요소 탭

현재 웹페이지를 구성하고 있는 HTML, CSS 등의 정보를 확인할 수 있음

### 7.2.1 요소 화면

태그를 클릭하면 브라우저 페이지의 해당요소가 강조되고, 해당 태그와 관련된 정보를 확인할 수 있음

- 요소 화면에서 바로 관련된 정보를 수정 할 수 있음

### 7.2.2 요소 정보

요소 관련된 정보를 얻을 수 있음

- `스타일`, 요소에 관련 된 스타일 정보 표기
- `계산됨`, 스타일이 적용된 결과물이 어떻게 표시 되는지 알려줌
- `레이아웃`, CSS 그리드나 레이아웃 관련 정보
- `이벤트 리스너`, 현재 요소에 부착된 이벤트 리스너 확인
    - 이벤트 버블링 등으로 이벤트를 발생시키는 경우 확인불가
- `DOM 중단점`, 중단점이 있는지 알려줌
- `속성`, 요소가 가지고 있는 모든 속성값
- `접근성`, 접근성 정보

---

## 7.3 소스 탭

웹 애플리케이션을 불러오기 위해 실행하거나 참조된 모든 파일을 확인 가능

- console.log로 디버깅 하지 않아도 변수 값 확인을 빠르게 할 수 있음

---

## 7.4 네트워크 탭

해당 웹페이지를 접속하는 순간부터 발생하는 모든 네트워크 관련 작동이 기록됨.  이 탭을 통해 중점적으로 봐야하는 부분은 아래와 같음

- 불필요한 요청 또는 중복되는 요청이 없는지
- 웹페이지 구성에 필요한 리소스 크기가 너무 크지 않은지
- 리소스를 부러오는 속도는 적절한지 또는 너무 속도가 오래걸리는 리소스는 없는지
- 리소스가 올바른 우선순위로 다운로드되어 페이지를 자연스럽게 만드는지

---

## 7.5 메모리 탭

현재 웹페이지가 차지하고 있는 메모리 관련 정보를 확인할 수 있다. 아래와 같은 프로파일링 유형이 있음

- 힙 스냅샷
- 타임라인 할당 계측
- 할당 샘플링

### 7.5.1 자바스크립트 인스턴스 VM 선택

현재 실행중인 자바스크립트 VM 인스턴스 확인 가능하다. 환경별 힙 크기를 확인할 수 있음

### 7.5.2 힙 스냅샷

- 현재 페이지의 메모리 상태를 확인해 볼 수 있는 메모리 프로파일 도구. 힙 스냅샷을 촬영하는 시점을 기준으로 마치 사진으로 촬영하듯 메모리 현황을 보여줌
- **얕은 크기와 유지된 크기**
    - 얕은 크기란 “객체 자체가 보여하는 메모리 바이트 크기”이고, 유지된 크기란 “해당 객체 자체뿐만 아니라 다른 부모가 존재하지 않는 모든 자식들의 크기까지 더한 .”
- 메모리 누수를 찾는경우, 얕은 크기는 작으나 유지된 크기가 큰 객체를 찾아야 함
    - 두 크기의 차이가 크다는 의미는 복잡한 참조관계를 가지고 있다는 의미이고 오랜 시간 동안 메모리에 남아있다면 많은 메모리를 점유하게 됨

### 7.5.3 타임라인 할당 계측

시간의 흐름에 따라 메모리 변화를 확인할 수 있는 기능

- FireNode: DOM을 그리기 위해 리액트가 1:1 구조로 생성

### 7.5.4 할당 샘플링

할당 계측과 비슷하지만 자바스크립트 실행 스택별로 분석할 수 있고, 이 분석을 함수단위로 진행.  브라우저에 주는 부담을 줄일 수 있어서 장시간에 걸치는 디버깅을 수행할 때 유리

---

## 7.6 Next.js 환경 디버깅하기

SSR 환경에서 메모리 누수가 발생한다면 서버의 부담이 된다. 결국, 모든 유저에게 영향을 줄 수 있음. 

### 7.6.1 Next.js 프로젝트를 디버그 모드로 실행하기

```
NODE_OPTIONS='--inspect' next dev
```

위 명령어를 통해 디버그 모드로 실행할 수 있음. 

### 7.6.2 Next.js 서버에 트래픽 유입시키기

오픈소스 도구인 [￼`ab`￼](https://httpd.apache.org/docs/2.4/en/programs/ab.html)를 이용해서 트래픽을 만들어본다.

```
ab -k -c 50 -n 10000 "localhost IP"
```

- k: KeepAlive 옵션 활성화
- c: 한번에 수행할 요청 수 지정
- n: 벤치마킹 세션에 요청할 갯수

### 7.6.3 Next.js 메모리 누수 지점 확인하기

함수 내부에서 외부 스코프 변수에 의존하는 작업을 한다면 메모리 누수 발생이 가능